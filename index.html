<html>
<head></head>
<body>
<script type='text/javascript'>
	function initEmbeddedMessaging() {
		try {
			embeddedservice_bootstrap.settings.language = 'en_US'; // For example, enter 'en' or 'en-US'

			embeddedservice_bootstrap.init(
				'00DO800000Gjfc5',
				'Messaging_Web',
				'https://marinecreditunion--stage.sandbox.my.site.com/ESWMessagingWeb1758567833973',
				{
					scrt2URL: 'https://marinecreditunion--stage.sandbox.my.salesforce-scrt.com'
				}
			);
		} catch (err) {
			console.error('Error loading Embedded Messaging: ', err);
		}
</script>
<script type="text/javascript" src="https://marinecreditunion--stage.sandbox.my.salesforce.com/embeddedservice/5.0/esw.min.js" onload="initEmbeddedMessaging()"></script>
<script>
window.addEventListener("onEmbeddedMessagingReady", async () => {
        console.log("Enhanced Chat is ready!");

        // Fetch browser details
        const fetchBrowserName = () => {
            const userAgent = navigator.userAgent;
            if (userAgent.includes("Opera") || userAgent.includes("Opr")) return "Opera";
            if (userAgent.includes("Edg")) return "Edge";
            if (userAgent.includes("Chrome")) return "Chrome";
            if (userAgent.includes("Safari")) return "Safari";
            if (userAgent.includes("Firefox")) return "Firefox";
            return "Unknown";
        };

        const browserName = fetchBrowserName();
        const browserLanguage = navigator.language;
        const browserPlatform = navigator.platform;
		const userAgentString = navigator.userAgent;
	
	let ipAddress = "Unknown";
    let city = "Unknown";
    let state = "Unknown";
    let country = "Unknown";
    let networkProvider = "Unknown";

    try {
        const response = await fetch("https://ipapi.co/json/");
        const data = await response.json();
        ipAddress = data.ip || "Unknown";
        city = data.city || "Unknown";
        state = data.region || "Unknown"; // State/Region
        country = data.country_name || "Unknown";
        networkProvider = data.org || "Unknown"; // ISP/Network Provider
    } catch (error) {
        console.error("IP fetch failed:", error);
    }

        // Pass data to Salesforce
        embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
            "BrowserName": browserName,
            "BrowserLanguage": browserLanguage,
            "BrowserPlatform": browserPlatform,
			"UserAgent": userAgentString,
			"IPAddress": ipAddress,
        	"City": city,
        	"State": state,
        	"Country": country,
        	"NetworkProvider": networkProvider	 
        });
    });
</script>
</body>
</html>








