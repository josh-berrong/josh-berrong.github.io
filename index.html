
<html>
<head>
    <title>Enhanced Messaging Test</title>
</head>
<body>
<script type="text/javascript">
function initEmbeddedMessaging() {
    try {
        embeddedservice_bootstrap.settings.language = 'en_US';
        embeddedservice_bootstrap.init(
            '00DO800000Gjfc5', // Org ID
            'Messaging_Web', // Deployment Name
            'https://marinecreditunion--stage.sandbox.my.site.com/ESWMessagingWeb1758567833973',
            {
                scrt2URL: 'https://marinecreditunion--stage.sandbox.my.salesforce-scrt.com'
            }
        );
    } catch (err) {
        console.error('Error loading Embedded Messaging: ', err);
    }
}
</script>

<!-- ✅ Load Salesforce SDK correctly -->
<script type="text/javascript" 
        src='https://marinecreditunion--stage.sandbox.my.site.com/ESWMessagingWeb1758567833973/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'>
</script>

<script>
window.addEventListener("onEmbeddedMessagingReady", () => {
    console.log("Enhanced Chat is ready!");

    // ✅ Browser Info
    const fetchBrowserName = () => {
        const ua = navigator.userAgent;
        if (ua.includes("Opera") || ua.includes("Opr")) return "Opera";
        if (ua.includes("Edg")) return "Edge";
        if (ua.includes("Chrome")) return "Chrome";
        if (ua.includes("Safari")) return "Safari";
        if (ua.includes("Firefox")) return "Firefox";
        return "Unknown";
    };

    const browserName = fetchBrowserName();
    const browserLanguage = navigator.language;
    const browserPlatform = navigator.platform;
    const userAgentString = navigator.userAgent;

    // ✅ IP + Location Info
    let ipAddress = "Unknown", city = "Unknown", state = "Unknown", country = "Unknown", networkProvider = "Unknown";

    try {
        const response = await fetch("https://ipapi.co/json/");
        const data = await response.json();
        ipAddress = data.ip || "Unknown";
        city = data.city || "Unknown";
        state = data.region || "Unknown";
        country = data.country_name || "Unknown";
        networkProvider = data.org || "Unknown";
    } catch (error) {
        console.error("IP fetch failed:", error);
    }

    // ✅ Send to Salesforce
    embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
        "BrowserName": browserName,
        "BrowserLanguage": browserLanguage,
        "BrowserPlatform": browserPlatform,
        "UserAgent": userAgentString,
        "IPAddress": ipAddress,
        "City": city,
        "State": state,
        "Country": country,
        "NetworkProvider": networkProvider
    });
});
</script>
</body>
</html>


